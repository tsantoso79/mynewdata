###############################################################################
# WORKFLOW 12: Compliance & Regulatory Tracking
# Ensures agent activities meet regulatory requirements, tracks licensing,
# continuing education, E&O insurance, and audit readiness.
###############################################################################
name: "12 - Compliance & Regulatory Tracking"

on:
  # Daily compliance check at 6 AM
  schedule:
    - cron: "0 6 * * *"
  workflow_dispatch:
    inputs:
      check_type:
        description: "Check (license_status, ce_credits, eo_insurance, audit_prep, disclosure_check)"
        required: false
        default: "license_status"

jobs:
  license-monitoring:
    name: "License Status Monitoring"
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v4

      - name: Check license expirations
        run: |
          echo "LICENSE MONITORING"
          echo "==================="
          echo "Checking all agent licenses..."
          echo ""
          echo "License types tracked:"
          echo "  - Life & Health"
          echo "  - Property & Casualty"
          echo "  - Series 6/7/63/65/66 (securities)"
          echo "  - State-specific licenses"
          echo "  - Surplus lines"
          echo ""
          echo "Alerts:"
          echo "  90 days before expiry: Email reminder"
          echo "  60 days before expiry: Manager notification"
          echo "  30 days before expiry: URGENT - Schedule renewal"
          echo "  Expired: BLOCK SALES + Compliance alert"

  continuing-education:
    name: "Continuing Education Tracking"
    runs-on: ubuntu-latest
    steps:
      - name: Track CE requirements
        run: |
          echo "CONTINUING EDUCATION STATUS"
          echo "============================"
          echo ""
          echo "Per-state requirements tracked:"
          echo "  - Total CE hours required"
          echo "  - Hours completed"
          echo "  - Hours remaining"
          echo "  - Deadline date"
          echo "  - Ethics hours (specific requirement)"
          echo "  - Product-specific hours"
          echo ""
          echo "Actions:"
          echo "  < 50% complete at midpoint: Warning"
          echo "  < 75% complete at 75% through: Urgent"
          echo "  Upcoming deadline + incomplete: Block + escalate"

  eo-insurance:
    name: "E&O Insurance Monitoring"
    runs-on: ubuntu-latest
    steps:
      - name: Check E&O status
        run: |
          echo "ERRORS & OMISSIONS INSURANCE"
          echo "============================="
          echo "  Current policy status: Active"
          echo "  Renewal date check: Running..."
          echo "  Coverage limit review: Running..."
          echo ""
          echo "  60-day renewal reminder"
          echo "  30-day renewal urgent alert"
          echo "  Coverage increase recommendations based on book size"

  disclosure-compliance:
    name: "Disclosure & Documentation Compliance"
    runs-on: ubuntu-latest
    steps:
      - name: Audit disclosure records
        run: |
          echo "DISCLOSURE COMPLIANCE CHECK"
          echo "==========================="
          echo ""
          echo "Required disclosures tracked:"
          echo "  [ ] Producer compensation disclosure"
          echo "  [ ] Privacy policy delivery"
          echo "  [ ] Replacement policy notices"
          echo "  [ ] Suitability documentation"
          echo "  [ ] Best interest documentation (where required)"
          echo "  [ ] Electronic delivery consent"
          echo ""
          echo "Scanning recent transactions for missing disclosures..."

  generate-compliance-report:
    name: "Compliance Dashboard"
    runs-on: ubuntu-latest
    needs: [license-monitoring, continuing-education, eo-insurance, disclosure-compliance]
    steps:
      - name: Create compliance report
        run: |
          echo "## Compliance Dashboard - $(date +%Y-%m-%d)" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### License Status" >> $GITHUB_STEP_SUMMARY
          echo "| License | State | Expiry | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|---------|-------|--------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| *(from records)* | | | |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### CE Progress" >> $GITHUB_STEP_SUMMARY
          echo "| State | Required | Completed | Deadline | Status |" >> $GITHUB_STEP_SUMMARY
          echo "|-------|----------|-----------|----------|--------|" >> $GITHUB_STEP_SUMMARY
          echo "| *(from records)* | | | | |" >> $GITHUB_STEP_SUMMARY
          echo "" >> $GITHUB_STEP_SUMMARY
          echo "### E&O Insurance: *(status)*" >> $GITHUB_STEP_SUMMARY
          echo "### Disclosure Compliance: *(% complete)*" >> $GITHUB_STEP_SUMMARY
